# rp2040-vpw
### RP2040-based OBD2 J1850 VPW to Serial Adapter (and data logger)
##### This project was an experiment to see if I could implement J1850 VPW in RP2040 PIO mode.  I am now using it as an in-vehicle data logger and for benchtop testing of GM parts that use Class2 messaging.
- Implements J1850 VPW protocol in PIO (including 4X mode)
	- *(see [vpw_receive](https://github.com/endjuser/rp2040-vpw/blob/main/vpw_receive.ino) and [vpw_send](https://github.com/endjuser/rp2040-vpw/blob/main/vpw_send.ino) files for details)*
- Supports multiple simultaneous connections e.g. USB serial + Bluetooth serial
- Acts as an ELM327 clone (with additional features)
- Includes some custom GM-specific commands to aid in diagnosing VPW-based modules on the workbench:
	- GMTP: send Test Device Present messages
	- GMPM: simulate BCM power mode messages (i.e. GMPM0609 to simulate Accessory mode)
	- GMVIN: simulate VIN responses from BCM

### Target Devices
This code was written using [Arduino IDE](https://www.arduino.cc/en/software) and designed to run on:
- [Waveshare RP2040 Zero](https://www.waveshare.com/wiki/RP2040-Zero)
- [Adafruit Feather RP2040](https://www.adafruit.com/product/4884) with the [Adalogger FeatherWing (RTC + SD)](https://www.adafruit.com/product/2922)

but it should theoretically run on any RP2040 device.  NeoPixel, RTC, and SD data logging capabilities can be disabled if not needed in your implementation.

My implementation uses an [NXP MC33390 **VPW TRANSCEIVER**](https://www.digikey.com/en/htmldatasheets/production/68114/0/0/1/mc33390) and a [SparkFun Bi-Directional Logic Level Converter](https://www.sparkfun.com/sparkfun-logic-level-converter-bi-directional.html) to interface the RP2040 with the vehicle data bus.  If you are planning to use this ONLY on a workbench (NOT in a vehicle), you *MAY* be able to omit the VPW transceiver and just level shift between 3.3V and your OBD2 bus idle voltage level.  It should be OK for receiving data.  The VPW transceiver performs requisite wave shaping on the output signal to prevent ringing interference from the square waves generated by the microcontroller.

## DISCLAIMER
This project is provided **as-is** with no warranties or guarantees of any kind. The code was developed for my own personal use and may contain **bugs, errors, or other issues**.

INTERFACING THE RP2040 (3.3V) TO THE OBD2 NETWORK (nominally 7V) REQUIRES (AT MINIMUM) **LEVEL SHIFTING** and a **VPW TRANSCEIVER**, and should also consider implementing additional over-voltage protection (transient spikes, load dump, jump starting, etc.) if used in a motor vehicle.

By using this code, you acknowledge that:

-   **Connecting to a motor vehicle is at your own risk.** Any misuse, malfunction, or unintended behavior could result in damage to your vehicle or other consequences.
-   **You are responsible for reviewing the source code and fully testing your setup** before using it in a real-world environment.
-   **I assume no responsibility** for any damages, data loss, malfunctions, or other issues that may arise from using this code or any modifications made to it.

Use this project responsibly and proceed with caution. If you are not comfortable with the risks involved, **do not use this code on a device in a motor vehicle, nor on a device connected to any other equipment of value**.
